(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{C8:()=>O,uM:()=>A,TD:()=>j});var e=function(t){if("Escape"==t.key||"Esc"==t.key){var e=document.querySelector(".popup_opened");r(e)}},o=function(t){return t.querySelector(".popup__button").textContent="Сохранение..."},n=function(t){return t.querySelector(".popup__button").textContent="Сохранить"},r=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",e)},c=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",e)};function a(t){A.src=t.target.closest(".photo-grid__item-image").src,A.alt=t.target.closest(".photo-grid__item-image").alt,j.textContent=t.target.closest(".photo-grid__item").querySelector(".photo-grid__title").textContent,c(O)}var i="https://nomoreparties.co/v1/wbf-cohort-4",u=function(t){return t.ok?t.json():Promise.reject("ОШИБКА: ".concat(t.status))};function l(t){var e;(e=t.target.closest(".photo-grid__item").querySelector(".photo-grid__item-image").id,fetch("".concat(i,"/cards/").concat(e),{method:"DELETE",headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a"}}).then(u)).then(t.target.closest(".photo-grid__item").remove()).catch((function(t){console.log("Удаление карточки  ".concat(t))}))}function s(t){var e,o=t.target.closest(".photo-grid__item").querySelector(".photo-grid__item-image").id,n=t.target.closest(".photo-grid__like-button"),r=t.target.closest(".photo-grid__like-area").querySelector(".photo-grid__liked-count");n.classList.contains("photo-grid__like-button_liked")?function(t){return fetch("".concat(i,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a"}}).then(u)}(o).then((function(t){r.textContent=t.likes.length,n.classList.remove("photo-grid__like-button_liked")})).catch((function(t){console.log("Удаление лайка ".concat(t))})):(e=o,fetch("".concat(i,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a"}}).then(u)).then((function(t){r.textContent=t.likes.length,n.classList.add("photo-grid__like-button_liked")})).catch((function(t){console.log("Установка лайка  ".concat(t))}))}var p=function(t,e,o,n,r){var c=r.cloneNode(!0);return c.querySelector(".photo-grid__item-image").src=t,c.querySelector(".photo-grid__item-image").id=o,c.querySelector(".photo-grid__item-image").alt=e,c.querySelector(".photo-grid__title").textContent=e,c.querySelector(".photo-grid__liked-count").textContent=n,c.querySelector(".photo-grid__delete-button").addEventListener("click",l),c.querySelector(".photo-grid__item-image").addEventListener("click",a),c.querySelector(".photo-grid__like-button").addEventListener("click",s),c},d=function(t){t.querySelector(".popup__form").reset(),Array.from(t.querySelectorAll(".popup__input_type_error")).forEach((function(e){e.classList.remove("popup__input_type_error"),t.querySelector("#".concat(e.id,"-error")).textContent=""}));var e=t.querySelector(".popup__button");e.disabled=!0,e.classList.add("popup__button_disabled")};function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var _=document.querySelector(".profile__title"),m=document.querySelector(".profile__subtitle"),h=document.querySelector(".profile__avatar"),y=document.forms.profileform,b=document.forms.avatarform,v=y.elements.nameinput,g=y.elements.aboutinput,S=b.elements.avatarlink,q=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup__profile"),C=document.querySelector(".popup__edit-avatar"),L=document.querySelector(".profile__avatar"),E=document.querySelector(".profile__add-button"),x=document.querySelector(".popup__add-card"),A=document.querySelector(".popup__picture"),j=document.querySelector(".popup__picture-title"),O=document.querySelector(".popup__place-picture"),T=document.querySelector(".photo-grid"),w=document.querySelector("#grid-item").content.querySelector(".photo-grid__item");Promise.all([fetch("".concat(i,"/users/me"),{headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a"}}).then(u),fetch("".concat(i,"/cards"),{headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a"}}).then(u)]).then((function(t){var e,o,n,r,c=(r=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,c,a,i=[],u=!0,l=!1;try{if(c=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;u=!1}else for(;!(u=(n=c.call(o)).done)&&(i.push(n.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?f(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=c[0],i=c[1];_.textContent=a.name,m.textContent=a.about,h.src=a.avatar,e=T,o=w,i.forEach((function(t){var n=p(t.link,t.name,t._id,t.likes.length,o);"fb4f164cb7425743afcd59f4"!==t.owner._id&&n.querySelector(".photo-grid__delete-area").classList.add("photo-grid__delete-area_hidden"),e.append(n)}))})).catch((function(t){console.log("Загрузка ".concat(t))})),q.addEventListener("click",(function(){d(k),c(k),v.value=_.textContent,g.value=m.textContent})),L.addEventListener("click",(function(){d(C),c(C),S.value=L.src})),b.addEventListener("submit",(function(t){var e;t.preventDefault(),o(b),(e=S.value,fetch("".concat(i,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then(u)).then((function(t){L.src=t.avatar,r(b.closest(".popup"))})).catch((function(t){console.log("Загрузка аватара ".concat(t))})).finally((function(){return n(b)}))})),y.addEventListener("submit",(function(t){var e,c;t.preventDefault(),o(y),(e=v.value,c=g.value,fetch("".concat(i,"/users/me"),{method:"PATCH",headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a","Content-Type":"application/json"},body:JSON.stringify({name:e,about:c})}).then(u)).then((function(t){_.textContent=t.name,m.textContent=t.about,r(y.closest(".popup"))})).catch((function(t){console.log("Редактирование профиля ".concat(t))})).finally((function(){return n(y)}))})),E.addEventListener("click",(function(){d(x),c(x)}));var z,P,D=document.forms.cardform,B=D.elements.placelink,N=D.elements.placeinput;D.addEventListener("submit",(function(t){var e,c;o(D),(e=N.value,c=B.value,fetch("".concat(i,"/cards"),{method:"POST",headers:{authorization:"b976a8cc-ba22-46b5-85e7-81e7fb97574a","Content-Type":"application/json"},body:JSON.stringify({name:e,link:c})}).then(u)).then((function(t){T.prepend(p(t.link,t.name,t._id,0,w)),r(D.closest(".popup")),D.reset()})).catch((function(t){console.log("Сохранение карточки ".concat(t))})).finally((function(){return n(D)})),t.preventDefault()})),document.addEventListener("click",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close-button"))&&r(t.target.closest(".popup"))})),P=(z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,Array.from(document.querySelectorAll(P)).forEach((function(t){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.valid?function(t,e,o){var n=t.querySelector("#".concat(e.id,"-error"));e.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(t,e,o):function(t,e,o){var n=t.querySelector("#".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),n.textContent=e.validationMessage,n.classList.add(o.errorClass)}(t,e,o)}(t,r,e),function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o.inactiveButtonClass),e.disabled=!1):(e.classList.add(o.inactiveButtonClass),e.disabled=!0)}(o,n,e)}))}))}(t,z)}))})();